<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cal.mapper.ProductMapper">

  <!-- 상품 등록 -->
  <insert id="insertProduct" parameterType="com.cal.dto.ProductDto">
    INSERT INTO products (name, price, category, imageUrl, keyword)
    VALUES (#{name}, #{price}, #{category}, #{imageUrl}, #{keyword})
  </insert>

  <!-- 상품 삭제 -->
  <delete id="productDelete" parameterType="int">
    DELETE FROM products WHERE id=#{id}
  </delete>

  <!-- 전체 목록 -->
  <select id="findAll" resultType="com.cal.dto.ProductDto">
    SELECT * FROM products ORDER BY id DESC
  </select>

  <!-- 단일 조회 -->
  <select id="findById" parameterType="int" resultType="com.cal.dto.ProductDto">
    SELECT * FROM products WHERE id = #{id}
  </select>

  <!-- 조건 검색 -->
  <select id="findWithCriteria" resultType="com.cal.dto.ProductDto" parameterType="com.cal.dto.ListDto">
    SELECT * FROM products
    <where>
      <if test="keyword != null and keyword != ''">
        name LIKE CONCAT('%', #{keyword}, '%')
      </if>
      <if test="category != null and category != ''">
        AND category = #{category}
      </if>
    </where>
    <choose>
      <when test="sort == 'old'">                        <!-- sort 종류 코드임 안하고 싶으면 지우면되는거 밑도 -->
        ORDER BY id ASC
      </when>
      <when test="sort == 'recommend'">
        ORDER BY id DESC
      </when>
      <otherwise>
        ORDER BY id DESC
      </otherwise>
    </choose>
    LIMIT #{size} OFFSET #{offset}
  </select>

  <!-- 조건 검색 개수 -->
  <select id="countWithCriteria" resultType="int" parameterType="com.cal.dto.ListDto">
    SELECT COUNT(*) FROM products
    <where>
      <if test="keyword != null and keyword != ''">
        name LIKE CONCAT('%', #{keyword}, '%')
      </if>
      <if test="category != null and category != ''">
        AND category = #{category}
      </if>
    </where>
  </select>

  <!-- 상품 1개 조회 (수정용) -->
  <select id="selectProductById" resultType="com.cal.dto.ProductDto">
    SELECT * FROM products WHERE id = #{id}
  </select>

  <!-- 상품 수정 -->
  <update id="updateProduct" parameterType="com.cal.dto.ProductDto">
    UPDATE products
    SET name = #{name},
        price = #{price},
        category = #{category},
        imageUrl = #{imageUrl}
    WHERE id = #{id}
  </update>

</mapper>
